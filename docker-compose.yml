version: "3.2"
services:
  volumes:
    pgdata:
        driver: local

services:
  db:
    container_name: db
    image: postgres
    environment:
        POSTGRES_USER: admin
        POSTGRES_PASSWORD: '123456'
        POSTGRES_DB: netdb
        PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
        - ./pgdata/:/var/lib/postgresql/data/pgdata

  python:
    restart: always
     build:
        context: .
        dockerfile: dockerfile
     volumes:
        - ./net:/srv/www/net
     ports:
        - 8000:8000
     command: "bash entrypoint.sh"
     env_file:
        - env.config
     depends_on:
        - db

   nginx:
     restart: always
     image: nginx
     expose:
        - 8080
     ports:
        - 8080:8080
     volumes:
        - ./net/static/:/srv/www/net/static/
        - ./net/logs:/srv/www/net/logs
        - ./nginx-server.conf:/etc/nginx/conf.d/default.conf
     depends_on:
        - python
